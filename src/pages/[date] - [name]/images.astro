---
import BaseLayout from "@layouts/BaseLayout.astro";
import Photo from "@components/Photo.astro";

export async function getStaticPaths() {
  const projectFilePaths = await Astro.glob("../../../public/proj/*");
  const filenamePattern = /\d{8} - (.+?)\./;

  return projectFilePaths.map((projectFilePath) => {
    const src = projectFilePath.default.src;
    const match = src.match(filenamePattern);
    return {
      params: {
        date: parseInt(match?.[0], 10),
        name: match?.[1],
      },
    };
  });
}

const { date, name } = Astro.params;

const path = `../proj/${date} - ${name}/1.jpg`;
---

<BaseLayout>
  <link rel="stylesheet" href="/photoswipe/photoswipe.css" slot="head" />
  <h1 class="text-center">if you see this, it means the code works!</h1>
  <div class="pswp-gallery" id="gallery">
    <Photo img={path} />
  </div>
</BaseLayout>
<script type="module">
  import PhotoSwipeLightbox from "/photoswipe/photoswipe-lightbox.esm.js";
  const lightbox = new PhotoSwipeLightbox({
    gallery: "#gallery",
    children: "a",
    pswpModule: () => import("/photoswipe/photoswipe.esm.js"),
    wheelToZoom: true,
    pinchToClose: false,
  });
  lightbox.addFilter("contentErrorElement", (contentErrorElement, content) => {
    const el = document.createElement("div");
    el.className = "pswp__error-msg";
    el.innerHTML = `<a href="${content.data.src}" target="_blank"> La #${
      content.slide.index + 1
    } immagine non può essere caricata, questo è un problema, contatta casu subito`;
    return el;
  });
  lightbox.init();
</script>

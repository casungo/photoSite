---
import BaseLayout from "@layouts/BaseLayout.astro";
import Card from "@components/Card.astro";
const title = "Home Page";

const getProjects = async () => {
  const projects = await Astro.glob('../../public/proj/*.jpg');
  const filenamePattern = /(\d{8}) - (.+?)\.([-\w]{8})?/;

  return projects.map((project) => {
    const src = project.default.src;
    const match = src.match(filenamePattern);
    const date = match[1];
    const name = match[2];
    const hash = match[3];
    return {
      img: `/proj/${date} - ${name}.jpg`,
      title: name,
      subtitle: `${date.slice(6, 8)}/${date.slice(4, 6)}/${date.slice(0, 4)}`,
      btnLink: `${date} - ${name}/images`
    };
  });
};

const projects = await getProjects();
---

<BaseLayout>
  <title slot="head">{title}</title>
  <div class="row m-3 row-cols-1 row-cols-md-2 row-cols-lg-3">
    {projects.map(project => (
      <Card
        img={project.img}
        title={project.title}
        subtitle={project.subtitle}
        btnLink={project.btnLink}
      />
    ))}
  </div>
</BaseLayout>